# 什么是SSR

SSR(Server-Side Rendering) 服务端渲染。

SPA(单页APP)：将页面代码发给浏览器。然后在浏览器中生成和操作 DOM。所以第一次访问时会比传统在后端生成 HTML 发送到浏览器要更慢。如果能在服务端渲染出 HTML，发送到浏览器，这样的 HTML 页面就不具备交互能力。所以要合理运用 SSR 技术，解决首屏慢的问题，还能获得更好的 SEO。



## 优点

- 更快响应时间，不用等待所有的 JS 都下载完成，浏览器能显示比较完整的页面。所以首屏快，先显示页面再加载 js
- 更好的 SEO，能把关键信息再后台渲染成 HTML，保证爬虫爬到。

## 缺点

- 占用更多 CPU 和内存资源。
- `window` | `document` | `alert` 等 API 无法使用，需要判断运行环境时服务端还是浏览器端。
- 开发调试有些麻烦，生命周期管理也复杂。
- 由于某些因素可能导致服务端渲染结果和浏览器端渲染结果不一致。





# 1. React 组件如何变成 HTML 字符串？

1. 创建组件实例：

   ```js
   inst = new Component(element.props, publicContext, updater);
   ```

   第三个参数 `updater` 注入了外部的 `updater` 用来拦截 `setState` 操作。

2. 用 `render` 和生命周期函数来进行渲染，`render` 时一直递归向下对子组件进行同样的处理，直到遇到原生 DOM 元素，才会将 DOM 元素渲染成字符串并输出。

3. 渲染 DOM 元素：然后正式拼接字符串，创建并处理子节点。

   ==注意：此时完整的 HTML 片段虽然尚未渲染完成(子节点没完全拼接完，开标签未合并)，但是开标签部分已经能完全确定，可以输出给客户端。== 

## 边拼接边流式发送



























